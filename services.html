<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mithila Help - Super Admin Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --orange: #FF9933; --green: #138808; --blue: #007BFF; --red: #dc3545; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0f2f5; padding: 10px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 500px; margin: 20px auto; }
        .admin-card { max-width: 950px; background: #fff; padding: 20px; border-radius: 10px; margin: auto; }
        h2, h3 { text-align: center; color: var(--green); margin-bottom: 15px; border-bottom: 2px solid var(--orange); padding-bottom: 5px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 25px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-blue { background: var(--blue); }
        .btn-red { background: var(--red); }
        .btn-green { background: var(--green); }
        .captcha { background: #eee; text-align: center; font-size: 22px; font-weight: bold; padding: 10px; border-radius: 8px; margin: 10px 0; letter-spacing: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f4f4f4; }
        .status-box { background: #fff3cd; padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid #ffeeba; font-size: 14px; }
        #login-page, #register-page, #order-page, #admin-page { display: none; }
    </style>
</head>
<body>

    <div id="login-page" class="card" style="display:block;">
        <h2>üîê ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <input type="text" id="l_user" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§Ø‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§®‡§æ‡§Æ">
        <input type="password" id="l_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <div class="captcha" id="cap_box"></div>
        <input type="text" id="l_cap" placeholder="‡§ï‡•à‡§™‡•ç‡§ö‡§æ ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç">
        <button class="btn btn-blue" onclick="handleLogin()">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
        <p style="text-align:center; margin-top:10px;">‡§®‡§Ø‡•á ‡§Ø‡•Ç‡§ú‡§∞? <a href="#" onclick="showPage('register-page')">‡§Ø‡§π‡§æ‡§Å ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</a></p>
    </div>

    <div id="register-page" class="card">
        <h2>üìù ‡§®‡§Ø‡§æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h2>
        <input type="text" id="r_name" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
        <input type="text" id="r_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <input type="date" id="r_dob" title="‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø">
        <input type="password" id="r_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç">
        <button class="btn btn-blue" onclick="handleRegister()">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
        <button class="btn" style="background:#666;" onclick="showPage('login-page')">‡§µ‡§æ‡§™‡§∏ ‡§≤‡•â‡§ó‡§ø‡§®</button>
    </div>

    <div id="order-page" class="card">
        <h2 id="u_welcome">‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</h2>
        <div id="tracking-info" class="status-box" style="display:none;"></div>
        <select id="o_prod" onchange="updateTotal()"></select>
        <input type="number" id="o_gram" placeholder="‡§ó‡•ç‡§∞‡§æ‡§Æ (‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ 100)" oninput="updateTotal()">
        <p id="o_price" style="text-align:center; font-weight:bold; font-size:18px; color:var(--green);">‡§ï‡•Ä‡§Æ‡§§: ‚Çπ0.00</p>
        <input type="text" id="o_addr" placeholder="‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ">
        <button class="btn btn-green" onclick="submitOrder()">‡§ë‡§∞‡•ç‡§°‡§∞ ‡§î‡§∞ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
        <div id="qrcode" style="display:flex; justify-content:center; margin-top:15px;"></div>
        <button class="btn btn-red" onclick="location.reload()">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
    </div>

    <div id="admin-page" class="admin-card">
        <h2>üõ†Ô∏è ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§™‡•à‡§®‡§≤: Shreya Rani</h2>
        
        <div style="background:#eef; padding:15px; border-radius:10px; margin-bottom:20px;">
            <h3>üì¶ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</h3>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <input type="text" id="p_name" placeholder="‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ" style="flex:2;">
                <input type="number" id="p_rate" placeholder="‡§∞‡•á‡§ü (‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã)" style="flex:1;">
                <button class="btn btn-blue" onclick="addUpdateProduct()" style="flex:1; margin-top:5px;">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
            <table>
                <thead><tr><th>‡§®‡§æ‡§Æ</th><th>‡§∞‡•á‡§ü (‚Çπ/kg)</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead>
                <tbody id="admin_prod_list"></tbody>
            </table>
        </div>

        <h3>üë• ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞‡•ç‡§° ‡§Ø‡•Ç‡§ú‡§∞</h3>
        <div style="overflow-x:auto;">
            <table id="user_table">
                <thead><tr><th>‡§®‡§æ‡§Æ</th><th>‡§´‡•ã‡§®</th><th>‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <h3>üì¶ ‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏ ‡§î‡§∞ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó</h3>
        <div style="overflow-x:auto;">
            <table id="order_table">
                <thead><tr><th>ID</th><th>‡§®‡§æ‡§Æ</th><th>‡§Ü‡§á‡§ü‡§Æ</th><th>‡§∏‡•ç‡§ü‡•á‡§ü‡§∏</th><th>‡§∏‡§Æ‡§Ø</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <button class="btn btn-red" onclick="location.reload()" style="max-width:200px; margin:20px auto; display:block;">‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
    </div>

    <script>
        let correctCap = 0, currentUser = null;
        
        // ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ
        let db = JSON.parse(localStorage.getItem('mch_db_v2')) || {
            users: [],
            products: [{name:"Packet A", rate:9300},{name:"Packet B", rate:11700},{name:"Packet C", rate:5500}],
            orders: [],
            blocked: []
        };

        function saveDB() { localStorage.setItem('mch_db_v2', JSON.stringify(db)); }

        function genCap() {
            let a = Math.floor(Math.random()*10), b = Math.floor(Math.random()*10);
            correctCap = a + b;
            document.getElementById('cap_box').innerText = `${a} + ${b} = ?`;
        }

        function showPage(id) {
            document.querySelectorAll('div[id$="-page"]').forEach(p => p.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if(id === 'login-page') genCap();
        }

        function handleLogin() {
            let u = document.getElementById('l_user').value, p = document.getElementById('l_pass').value, c = document.getElementById('l_cap').value;
            if(c != correctCap) return alert("‡§ó‡§≤‡§§ ‡§ï‡•à‡§™‡•ç‡§ö‡§æ!");
            
            if(u === "shreya rani" && p === "mydearshreya@#") { loadAdmin(); showPage('admin-page'); return; }

            if(db.blocked.includes(u)) return alert("‡§Ü‡§™‡§ï‡§æ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¨‡•ç‡§≤‡•â‡§ï ‡§π‡•à!");
            let user = db.users.find(x => x.phone === u && x.pass === p);
            if(user) { currentUser = user; loadUserOrderPage(); showPage('order-page'); } 
            else alert("‡§ó‡§≤‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£!");
        }

        function handleRegister() {
            let n = document.getElementById('r_name').value, ph = document.getElementById('r_phone').value,
                ps = document.getElementById('r_pass').value, d = document.getElementById('r_dob').value;
            if(!n || ph.length < 10 || !ps) return alert("‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!");
            db.users.push({name: n, phone: ph, dob: d, pass: ps}); saveDB();
            alert("‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§∏‡§´‡§≤!"); showPage('login-page');
        }

        // --- USER FUNCTIONS ---
        function loadUserOrderPage() {
            document.getElementById('u_welcome').innerText = `‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ${currentUser.name}`;
            let sel = document.getElementById('o_prod');
            sel.innerHTML = `<option value="">-- ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç --</option>`;
            db.products.forEach(p => sel.innerHTML += `<option value="${p.rate}">${p.name} (‚Çπ${p.rate}/kg)</option>`);
            
            let myOrder = db.orders.slice().reverse().find(o => o.phone === currentUser.phone);
            if(myOrder) {
                document.getElementById('tracking-info').style.display = 'block';
                document.getElementById('tracking-info').innerHTML = `üìå <b>‡§∏‡•ç‡§ü‡•á‡§ü‡§∏:</b> ${myOrder.status} | ‚è≥ <b>‡§∏‡§Æ‡§Ø:</b> ${myOrder.eta || '‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä'}`;
            }
        }

        function updateTotal() {
            let rate = document.getElementById('o_prod').value, gram = document.getElementById('o_gram').value;
            if(rate && gram >= 100) {
                let total = (rate / 1000) * gram;
                document.getElementById('o_price').innerText = `‡§ï‡•Ä‡§Æ‡§§: ‚Çπ${total.toFixed(2)}`;
            }
        }

        function submitOrder() {
            let prodName = document.getElementById('o_prod').options[document.getElementById('o_prod').selectedIndex].text;
            let gram = document.getElementById('o_gram').value, addr = document.getElementById('o_addr').value;
            let price = document.getElementById('o_price').innerText.split('‚Çπ')[1];
            if(!gram || !addr || !price) return alert("‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç!");

            let orderID = "ORD" + Math.floor(Math.random()*9000);
            db.orders.push({id:orderID, name:currentUser.name, phone:currentUser.phone, item:prodName, price:price, status:'Pending', eta:''});
            saveDB();

            let upi = `upi://pay?pa=7033578145@sbi&pn=MithilaHelp&am=${price}&cu=INR&tn=${orderID}`;
            document.getElementById('qrcode').innerHTML = "";
            new QRCode(document.getElementById('qrcode'), {text:upi, width:150, height:150});
            alert("‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∏‡§´‡§≤! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§");
        }

        // --- ADMIN FUNCTIONS ---
        function loadAdmin() {
            // ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            let pl = document.getElementById('admin_prod_list'); pl.innerHTML = "";
            db.products.forEach((p, i) => {
                pl.innerHTML += `<tr><td>${p.name}</td><td>${p.rate}</td>
                <td><button onclick="editProduct(${i})" style="color:blue;">Edit</button> | 
                <button onclick="deleteProduct(${i})" style="color:red;">Del</button></td></tr>`;
            });

            // ‡§Ø‡•Ç‡§ú‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            let ut = document.querySelector('#user_table tbody'); ut.innerHTML = "";
            db.users.forEach(u => {
                let isBlocked = db.blocked.includes(u.phone);
                ut.innerHTML += `<tr><td>${u.name}</td><td>${u.phone}</td><td>${u.pass}</td>
                <td><button onclick="toggleBlock('${u.phone}')" style="background:${isBlocked?'green':'red'}; color:white; border:none; padding:4px; border-radius:4px;">${isBlocked?'Unblock':'Block'}</button></td></tr>`;
            });

            // ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            let ot = document.querySelector('#order_table tbody'); ot.innerHTML = "";
            db.orders.forEach((o, i) => {
                ot.innerHTML += `<tr><td>${o.id}</td><td>${o.name}</td><td>${o.item}</td>
                <td><select onchange="db.orders[${i}].status=this.value; saveDB();"><option ${o.status=='Pending'?'selected':''}>Pending</option><option ${o.status=='Packing'?'selected':''}>Packing</option><option ${o.status=='On way'?'selected':''}>On way</option><option ${o.status=='Delivered'?'selected':''}>Delivered</option></select></td>
                <td><input type="text" value="${o.eta}" onchange="db.orders[${i}].eta=this.value; saveDB();" placeholder="2 hours"></td>
                <td><button onclick="saveDB(); alert('Updated!')">Save</button></td></tr>`;
            });
        }

        function addUpdateProduct() {
            let n = document.getElementById('p_name').value, r = document.getElementById('p_rate').value;
            if(!n || !r) return alert("‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§∞‡•á‡§ü ‡§≠‡§∞‡•á‡§Ç!");
            let index = db.products.findIndex(x => x.name === n);
            if(index > -1) db.products[index].rate = r; 
            else db.products.push({name: n, rate: r});
            saveDB(); loadAdmin(); alert("Product Saved!");
            document.getElementById('p_name').value = ""; document.getElementById('p_rate').value = "";
        }

        function editProduct(i) {
            document.getElementById('p_name').value = db.products[i].name;
            document.getElementById('p_rate').value = db.products[i].rate;
        }

        function deleteProduct(i) { if(confirm("Delete Product?")) { db.products.splice(i, 1); saveDB(); loadAdmin(); } }

        function toggleBlock(ph) {
            if(db.blocked.includes(ph)) db.blocked = db.blocked.filter(x => x !== ph);
            else db.blocked.push(ph);
            saveDB(); loadAdmin();
        }

        window.onload = genCap;
    </script>
</body>
</html>
