<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mithila Help - Live Cloud Control</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --orange: #FF9933; --green: #138808; --blue: #007BFF; --red: #dc3545; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: #f4f7f6; padding: 10px; }
        .box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 450px; margin: 15px auto; display: none; }
        .admin-wide { max-width: 1100px; background: white; padding: 20px; border-radius: 12px; margin: auto; display: none; border-top: 5px solid var(--orange); }
        h2 { text-align: center; color: var(--green); margin-bottom: 15px; }
        input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 6px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 25px; color: white; font-weight: bold; cursor: pointer; }
        .btn-blue { background: var(--blue); } .btn-green { background: var(--green); } .btn-red { background: var(--red); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>

    <div id="box-login" class="box" style="display:block;">
        <h2>üîê Mithila ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <input type="text" id="l_phone" placeholder="Mobile Number">
        <input type="password" id="l_pass" placeholder="Password">
        <button class="btn btn-blue" onclick="doLogin()">Login</button>
        <p style="text-align:center; margin-top:10px;">
            <span onclick="go('box-reg')" style="color:var(--blue); cursor:pointer;">Naya Account Banayein</span>
        </p>
    </div>

    <div id="box-reg" class="box">
        <h2>üìù Registration</h2>
        <input type="text" id="r_name" placeholder="Pura Naam">
        <input type="text" id="r_phone" placeholder="Mobile Number">
        <input type="password" id="r_pass" placeholder="Password Banayein">
        <button class="btn btn-blue" onclick="doReg()">Register Karein</button>
        <button class="btn" style="background:#666; margin-top:5px;" onclick="go('box-login')">Piche Jayein</button>
    </div>

    <div id="box-order" class="box">
        <h3 id="wel_user">Namaste</h3>
        <label>Item Chunnein:</label>
        <select id="sel_p"></select>
        <input type="number" id="sel_qty" placeholder="Kitna chahiye (Quantity)">
        <input type="text" id="sel_ad" placeholder="Pura Pata (Address)">
        <button class="btn btn-green" onclick="placeOrder()">Order Confirm Karein</button>
        <button class="btn btn-red" style="margin-top:10px;" onclick="location.reload()">Logout</button>
    </div>

    <div id="box-admin" class="admin-wide">
        <h2>üõ†Ô∏è Admin: Shreya Rani Control</h2>
        <div style="background:#f9f9f9; padding:15px; border-radius:8px;">
            <h3>üì¶ Naya Product Dalein</h3>
            <input type="text" id="adm_pn" placeholder="Product ka Naam">
            <input type="number" id="adm_pr" placeholder="Rate (Price)">
            <button class="btn btn-blue" onclick="admAddP()">Global Update Karein</button>
        </div>
        <table>
            <thead><tr><th>Product</th><th>Price</th><th>Action</th></tr></thead>
            <tbody id="p_list_body"></tbody>
        </table>
        <button class="btn btn-red" style="width:150px; margin:20px auto; display:block;" onclick="location.reload()">Logout</button>
    </div>

    <script>
        // Aapke screenshot se li gayi configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBtLLOyVgt5hQwxokdsSRkeArZab5kyr_Q",
            authDomain: "mithilahelp-4107d.firebaseapp.com",
            databaseURL: "https://mithilahelp-4107d-default-rtdb.firebaseio.com",
            projectId: "mithilahelp-4107d",
            storageBucket: "mithilahelp-4107d.firebasestorage.app",
            messagingSenderId: "525345376934",
            appId: "1:525345376934:web:7083c7cecccd26a4a78267"
        };

        firebase.initializeApp(firebaseConfig);
        const rdb = firebase.database();
        let currentUser = null;

        function go(id) {
            document.querySelectorAll('.box, .admin-wide').forEach(b => b.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        // --- Live Cloud Functions ---

        function doReg() {
            let n = document.getElementById('r_name').value, ph = document.getElementById('r_phone').value, ps = document.getElementById('r_pass').value;
            if(!n || !ph || !ps) return alert("Sab bharen!");
            rdb.ref('users/' + ph).set({ name: n, phone: ph, pass: ps });
            alert("Account ban gaya! Ab login karein."); go('box-login');
        }

        function doLogin() {
            let u = document.getElementById('l_phone').value, p = document.getElementById('l_pass').value;
            if(u === "shreya rani" && p === "mydearshreya@#") { loadAdminData(); go('box-admin'); return; }
            
            rdb.ref('users/' + u).once('value', (s) => {
                let user = s.val();
                if(user && user.pass === p) { currentUser = user; go('box-order'); loadUserPanel(); }
                else alert("Galat detail! Sahi number aur password dalein.");
            });
        }

        function admAddP() {
            let n = document.getElementById('adm_pn').value, r = document.getElementById('adm_pr').value;
            if(!n || !r) return alert("Naam aur Rate dalein!");
            rdb.ref('products/').push({ name: n, rate: r });
            alert("Product har phone mein update ho gaya!");
            document.getElementById('adm_pn').value = ""; document.getElementById('adm_pr').value = "";
        }

        function loadAdminData() {
            rdb.ref('products/').on('value', (s) => {
                let data = s.val(), html = "";
                for(let id in data) {
                    html += `<tr><td>${data[id].name}</td><td>‚Çπ${data[id].rate}</td>
                    <td><button onclick="rdb.ref('products/${id}').remove()" style="color:red; cursor:pointer;">Delete</button></td></tr>`;
                }
                document.getElementById('p_list_body').innerHTML = html;
            });
        }

        function loadUserPanel() {
            document.getElementById('wel_user').innerText = "Namaste, " + currentUser.name;
            rdb.ref('products/').on('value', (s) => {
                let data = s.val(), html = "<option value=''>Chunnein...</option>";
                for(let id in data) html += `<option value="${id}">${data[id].name} - ‚Çπ${data[id].rate}</option>`;
                document.getElementById('sel_p').innerHTML = html;
            });
        }

        function placeOrder() {
            let pid = document.getElementById('sel_p').value, q = document.getElementById('sel_qty').value, ad = document.getElementById('sel_ad').value;
            if(!pid || !q || !ad) return alert("Pura detail bharen!");
            
            rdb.ref('products/' + pid).once('value', (s) => {
                let p = s.val();
                rdb.ref('orders/').push({ userName: currentUser.name, phone: currentUser.phone, item: p.name, qty: q, address: ad, status: "Pending" });
                alert("Order Safalta-purvak bhej diya gaya!");
            });
        }
    </script>
</body>
</html>
