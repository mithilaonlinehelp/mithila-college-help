<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mithila College Help - Pro System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        :root { --orange: #FF9933; --green: #138808; --blue: #007BFF; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background: linear-gradient(120deg, var(--orange), #ffffff, var(--green));
            background-size: 300% 300%;
            animation: moveBg 10s infinite;
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
        }
        @keyframes moveBg { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }

        .card { width: 90%; max-width: 450px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        h2 { text-align: center; color: var(--green); margin-bottom: 20px; border-bottom: 2px solid var(--orange); padding-bottom: 10px; }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; outline: none; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 30px; color: white; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; }
        
        .btn-blue { background: var(--blue); }
        .btn-mix { background: linear-gradient(to right, var(--orange), var(--green)); }
        
        .captcha { background: #f0f0f0; text-align: center; font-size: 20px; font-weight: bold; letter-spacing: 5px; padding: 10px; border-radius: 8px; margin: 10px 0; }
        .link { text-align: center; margin-top: 15px; font-size: 14px; }
        .link span { color: var(--blue); cursor: pointer; font-weight: bold; text-decoration: underline; }
        
        #register-div, #forget-div, #order-div, #receipt-div { display: none; }
    </style>
</head>
<body>

    <div id="login-div" class="card">
        <h2>üîê Login</h2>
        <input type="text" id="l_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ (10 ‡§Ö‡§Ç‡§ï)">
        <input type="password" id="l_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <div class="captcha" id="l_cap_text"></div>
        <input type="text" id="l_cap_val" placeholder="‡§ä‡§™‡§∞ ‡§ï‡§æ ‡§ú‡•ã‡§°‡§º ‡§≤‡§ø‡§ñ‡•á‡§Ç">
        <button class="btn btn-blue" onclick="processLogin()">Login</button>
        <div class="link">‡§®‡§Ø‡•á ‡§π‡•à‡§Ç? <span onclick="toggleView('register-div')">Register ‡§ï‡§∞‡•á‡§Ç</span></div>
        <div class="link"><span onclick="toggleView('forget-div')">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§≠‡•Ç‡§≤ ‡§ó‡§è?</span></div>
    </div>

    <div id="register-div" class="card">
        <h2>üìù Registration</h2>
        <input type="text" id="r_name" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
        <input type="text" id="r_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <label style="font-size: 12px; font-weight: bold;">‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø (DOB):</label>
        <input type="date" id="r_dob">
        <input type="password" id="r_pass" placeholder="‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <button class="btn btn-blue" onclick="processRegister()">Register Now</button>
        <div class="link">‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§π‡•à? <span onclick="toggleView('login-div')">Login</span></div>
    </div>

    <div id="forget-div" class="card">
        <h2>üîç Recovery</h2>
        <input type="text" id="f_phone" placeholder="‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞‡•ç‡§° ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <label style="font-size: 12px; font-weight: bold;">‡§Ö‡§™‡§®‡•Ä DOB ‡§ö‡•Å‡§®‡•á‡§Ç:</label>
        <input type="date" id="f_dob">
        <button class="btn btn-blue" onclick="processForget()">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å</button>
        <div class="link"><span onclick="toggleView('login-div')">‡§µ‡§æ‡§™‡§∏ ‡§≤‡•â‡§ó‡§ø‡§®</span></div>
    </div>

    <div id="order-div" class="card">
        <h2 id="user-welcome">üõí Order</h2>
        <select id="o_item" onchange="calcPrice()">
            <option value="">-- ‡§™‡•à‡§ï‡•á‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
            <option value="Packet A" data-rate="9300">Packet A (‚Çπ9300/kg)</option>
            <option value="Packet B" data-rate="11700">Packet B (‚Çπ11700/kg)</option>
            <option value="Packet C" data-rate="5500">Packet C (‚Çπ5500/kg)</option>
        </select>
        <input type="number" id="o_gram" placeholder="‡§ï‡§ø‡§§‡§®‡§æ ‡§ó‡•ç‡§∞‡§æ‡§Æ? (Min 100)" oninput="calcPrice()">
        <div id="o_price" style="text-align:center; font-weight:bold; padding:10px;">‡§ï‡•Ä‡§Æ‡§§: ‚Çπ0.00</div>
        <input type="text" id="o_addr" placeholder="‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ">
        <button class="btn btn-mix" onclick="processOrder()">Pay & Generate QR</button>
        <div id="qrcode" style="display:flex; justify-content:center; margin-top:15px;"></div>
        <button id="btn-rec" class="btn" style="background:#28a745; display:none;" onclick="showReceipt()">‡§∞‡§∏‡•Ä‡§¶ ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
    </div>

    <div id="receipt-div" class="card">
        <h2>üßæ Receipt</h2>
        <div id="rec_data" style="line-height: 1.8; margin-bottom: 15px; font-size: 14px;"></div>
        <button class="btn" style="background:#25D366;" onclick="sendWhatsApp()">WhatsApp ‡§™‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡•á‡§ú‡•á‡§Ç</button>
        <button class="btn" style="background:#333;" onclick="location.reload()">Logout</button>
    </div>

    <script>
        let correctCap = 0;
        let finalAmt = 0;
        let loggedInUser = null;

        // ‡§µ‡•ç‡§Ø‡•Ç ‡§¨‡§¶‡§≤‡•á‡§Ç
        function toggleView(id) {
            document.querySelectorAll('.card').forEach(c => c.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if(id === 'login-div') createCaptcha();
        }

        // ‡§ï‡•à‡§™‡•ç‡§ö‡§æ
        function createCaptcha() {
            let a = Math.floor(Math.random() * 10);
            let b = Math.floor(Math.random() * 10);
            correctCap = a + b;
            document.getElementById('l_cap_text').innerText = `${a} + ${b} = ?`;
        }

        // ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®
        function processRegister() {
            const name = document.getElementById('r_name').value;
            const phone = document.getElementById('r_phone').value;
            const dob = document.getElementById('r_dob').value;
            const pass = document.getElementById('r_pass').value;

            if(!name || phone.length < 10 || !dob || !pass) return alert("‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!");

            let users = JSON.parse(localStorage.getItem('m_users') || "[]");
            if(users.find(u => u.phone === phone)) return alert("‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•à!");

            users.push({name, phone, dob, pass});
            localStorage.setItem('m_users', JSON.stringify(users));
            alert("‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§∏‡§´‡§≤! ‡§Ö‡§¨ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç‡•§");
            toggleView('login-div');
        }

        // ‡§≤‡•â‡§ó‡§ø‡§®
        function processLogin() {
            const phone = document.getElementById('l_phone').value;
            const pass = document.getElementById('l_pass').value;
            const cap = document.getElementById('l_cap_val').value;

            if(cap != correctCap) return alert("‡§ï‡•à‡§™‡•ç‡§ö‡§æ ‡§ó‡§≤‡§§ ‡§π‡•à!");

            let users = JSON.parse(localStorage.getItem('m_users') || "[]");
            let user = users.find(u => u.phone === phone && u.pass === pass);

            if(user) {
                loggedInUser = user;
                document.getElementById('user-welcome').innerText = "‡§®‡§Æ‡§∏‡•ç‡§§‡•á, " + user.name;
                toggleView('order-div');
            } else {
                alert("‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ó‡§≤‡§§ ‡§π‡•à!");
                createCaptcha();
            }
        }

        // ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä
        function processForget() {
            const phone = document.getElementById('f_phone').value;
            const dob = document.getElementById('f_dob').value;
            let users = JSON.parse(localStorage.getItem('m_users') || "[]");
            let user = users.find(u => u.phone === phone && u.dob === dob);

            if(user) alert("‡§Ü‡§™‡§ï‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§π‡•à: " + user.pass);
            else alert("‡§°‡•á‡§ü‡§æ ‡§Æ‡•à‡§ö ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü!");
        }

        // ‡§ï‡•Ä‡§Æ‡§§ ‡§ó‡§£‡§®‡§æ
        function calcPrice() {
            const sel = document.getElementById('o_item');
            const gram = document.getElementById('o_gram').value;
            const rate = sel.options[sel.selectedIndex].getAttribute('data-rate');
            if(rate && gram >= 100) {
                finalAmt = (rate / 1000) * gram;
                document.getElementById('o_price').innerText = `‡§ï‡•Ä‡§Æ‡§§: ‚Çπ${finalAmt.toFixed(2)}`;
            }
        }

        // ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§î‡§∞ ‡§ï‡•ç‡§Ø‡•Ç‡§Ü‡§∞
        function processOrder() {
            const addr = document.getElementById('o_addr').value;
            if(!addr || finalAmt === 0) return alert("‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç!");
            
            const upi = `upi://pay?pa=7033578145@sbi&pn=MithilaHelp&am=${finalAmt.toFixed(2)}&cu=INR&tn=Order_By_${loggedInUser.name}`;
            const qrElem = document.getElementById('qrcode');
            qrElem.innerHTML = "";
            new QRCode(qrElem, { text: upi, width: 150, height: 150 });
            document.getElementById('btn-rec').style.display = 'block';
        }

        function showReceipt() {
            toggleView('receipt-div');
            document.getElementById('rec_data').innerHTML = `
                <b>‡§®‡§æ‡§Æ:</b> ${loggedInUser.name}<br>
                <b>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:</b> ${loggedInUser.phone}<br>
                <b>‡§∏‡§æ‡§Æ‡§æ‡§®:</b> ${document.getElementById('o_item').value}<br>
                <b>‡§µ‡§ú‡§®:</b> ${document.getElementById('o_gram').value} ‡§ó‡•ç‡§∞‡§æ‡§Æ<br>
                <b>‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</b> ‚Çπ${finalAmt.toFixed(2)}<br>
                <b>‡§™‡§§‡§æ:</b> ${document.getElementById('o_addr').value}
            `;
        }

        function sendWhatsApp() {
            const admin = "916200732472";
            const text = `*‡§®‡§Ø‡§æ ‡§ë‡§∞‡•ç‡§°‡§∞*%0A‡§®‡§æ‡§Æ: ${loggedInUser.name}%0A‡§∏‡§æ‡§Æ‡§æ‡§®: ${document.getElementById('o_item').value}%0A‡§µ‡§ú‡§®: ${document.getElementById('o_gram').value}g%0A‡§∞‡§æ‡§∂‡§ø: ‚Çπ${finalAmt.toFixed(2)}%0A‡§™‡§§‡§æ: ${document.getElementById('o_addr').value}`;
            window.open(`https://wa.me/${admin}?text=${text}`, '_blank');
        }

        window.onload = createCaptcha;
    </script>
</body>
</html>
