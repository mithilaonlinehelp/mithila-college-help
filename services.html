<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mithila Help - Super Admin Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --orange: #FF9933; --green: #138808; --blue: #007BFF; --red: #dc3545; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0f2f5; padding: 10px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 500px; margin: 20px auto; }
        .admin-card { max-width: 1000px; background: #fff; padding: 20px; border-radius: 10px; margin: auto; }
        h2, h3 { text-align: center; color: var(--green); margin-bottom: 15px; border-bottom: 2px solid var(--orange); padding-bottom: 5px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 25px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-blue { background: var(--blue); }
        .btn-red { background: var(--red); }
        .btn-green { background: var(--green); }
        .captcha { background: #eee; text-align: center; font-size: 22px; font-weight: bold; padding: 10px; border-radius: 8px; margin: 10px 0; letter-spacing: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f4f4f4; }
        .status-box { background: #fff3cd; padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid #ffeeba; }
        #login-page, #register-page, #order-page, #admin-page, #profile-page { display: none; }
    </style>
</head>
<body>

    <div id="login-page" class="card" style="display:block;">
        <h2>üîê ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <input type="text" id="l_user" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§Ø‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§®‡§æ‡§Æ">
        <input type="password" id="l_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <div class="captcha" id="cap_box"></div>
        <input type="number" id="l_cap" placeholder="‡§ï‡•à‡§™‡•ç‡§ö‡§æ ‡§â‡§§‡•ç‡§§‡§∞">
        <button class="btn btn-blue" onclick="handleLogin()">Login</button>
        <p style="text-align:center; margin-top:10px;">‡§®‡§Ø‡•á? <a href="#" onclick="showPage('register-page')">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</a></p>
    </div>

    <div id="register-page" class="card">
        <h2>üìù ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h2>
        <input type="text" id="r_name" placeholder="‡§®‡§æ‡§Æ">
        <input type="text" id="r_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤">
        <input type="password" id="r_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <button class="btn btn-blue" onclick="handleRegister()">Register</button>
        <button class="btn" style="background:#666;" onclick="showPage('login-page')">Back</button>
    </div>

    <div id="profile-page" class="card">
        <h2>üë§ ‡§è‡§°‡§ø‡§ü ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤</h2>
        <input type="text" id="edit_name" placeholder="‡§®‡§Ø‡§æ ‡§®‡§æ‡§Æ">
        <input type="password" id="edit_pass" placeholder="‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <button class="btn btn-green" onclick="saveProfile()">Save Changes</button>
        <button class="btn" style="background:#666;" onclick="showPage('order-page')">Back</button>
    </div>

    <div id="order-page" class="card">
        <div style="display:flex; justify-content:space-between;">
            <h3 id="u_welcome">‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</h3>
            <button onclick="loadProfile()" style="color:var(--blue); border:none; background:none; cursor:pointer;">Edit Profile</button>
        </div>
        <div id="u_status" class="status-box" style="display:none;"></div>
        <select id="o_prod" onchange="updateTotal()"></select>
        <input type="number" id="o_gram" placeholder="‡§ó‡•ç‡§∞‡§æ‡§Æ" oninput="updateTotal()">
        <p id="o_price" style="text-align:center; font-weight:bold; font-size:18px; color:var(--green);">‚Çπ0.00</p>
        <input id="o_addr" placeholder="‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§™‡§§‡§æ">
        <select id="o_method"><option value="Online">Online Payment</option><option value="COD">Cash on Delivery</option></select>
        <button class="btn btn-green" onclick="submitOrder()">Place Order</button>
        <div id="qrcode" style="display:flex; justify-content:center; margin-top:15px;"></div>
        <div id="user_cancel_div"></div>
        <button class="btn btn-red" onclick="location.reload()">Logout</button>
    </div>

    <div id="admin-page" class="admin-card">
        <h2>üõ†Ô∏è ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§™‡•à‡§®‡§≤: Shreya Rani</h2>
        <div style="background:#d1ecf1; padding:15px; border-radius:10px; text-align:center; font-weight:bold; margin-bottom:10px;" id="earning">‡§ï‡§Æ‡§æ‡§à: ‚Çπ0.00</div>
        
        <h3>üì¶ ‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</h3>
        <table id="admin_orders">
            <thead><tr><th>ID</th><th>‡§®‡§æ‡§Æ/‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤</th><th>‡§™‡•á‡§Æ‡•á‡§Ç‡§ü</th><th>‡§∏‡•ç‡§ü‡•á‡§ü‡§∏</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead>
            <tbody></tbody>
        </table>
        <button class="btn btn-red" onclick="location.reload()" style="max-width:200px; margin:auto; display:block;">Admin Logout</button>
    </div>

    <script>
        let correctCap = 0, currentUser = null;
        let db = JSON.parse(localStorage.getItem('mch_v5')) || {
            users: [], products: [{name:"Packet A", rate:9300},{name:"Packet B", rate:11700}], orders: [], blocked: []
        };

        function save() { localStorage.setItem('mch_v5', JSON.stringify(db)); }

        function showPage(id) {
            document.querySelectorAll('div[id$="-page"]').forEach(p => p.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if(id === 'login-page') genCap();
        }

        function genCap() {
            let a = Math.floor(Math.random()*10), b = Math.floor(Math.random()*10);
            correctCap = a+b; document.getElementById('cap_box').innerText = `${a} + ${b} = ?`;
        }

        function handleLogin() {
            let u = document.getElementById('l_user').value, p = document.getElementById('l_pass').value, c = document.getElementById('l_cap').value;
            if(c != correctCap) return alert("Wrong Captcha");
            if(u === "shreya rani" && p === "mydearshreya@#") { loadAdmin(); showPage('admin-page'); return; }
            let user = db.users.find(x => x.phone === u && x.pass === p);
            if(user) { if(db.blocked.includes(u)) return alert("Blocked!"); currentUser = user; loadUser(); showPage('order-page'); } else alert("Error!");
        }

        function handleRegister() {
            let n = document.getElementById('r_name').value, ph = document.getElementById('r_phone').value, ps = document.getElementById('r_pass').value;
            db.users.push({name:n, phone:ph, pass:ps}); save(); alert("Success!"); showPage('login-page');
        }

        function loadProfile() {
            document.getElementById('edit_name').value = currentUser.name;
            document.getElementById('edit_pass').value = currentUser.pass;
            showPage('profile-page');
        }

        function saveProfile() {
            let idx = db.users.findIndex(x => x.phone === currentUser.phone);
            db.users[idx].name = document.getElementById('edit_name').value;
            db.users[idx].pass = document.getElementById('edit_pass').value;
            currentUser = db.users[idx]; save(); alert("Updated!"); showPage('order-page');
        }

        function loadUser() {
            document.getElementById('u_welcome').innerText = "Namaste, " + currentUser.name;
            let sel = document.getElementById('o_prod'); sel.innerHTML = `<option value="">Choose Item</option>`;
            db.products.forEach(p => sel.innerHTML += `<option value="${p.rate}">${p.name}</option>`);
            
            let last = db.orders.slice().reverse().find(o => o.phone === currentUser.phone);
            let cancelDiv = document.getElementById('user_cancel_div');
            cancelDiv.innerHTML = "";
            if(last) {
                document.getElementById('u_status').style.display='block';
                document.getElementById('u_status').innerHTML = `üìå <b>Status:</b> ${last.status}`;
                if(last.status === "Pending") {
                    cancelDiv.innerHTML = `<button class="btn btn-red" onclick="cancelOrder('${last.id}')">Cancel My Order</button>`;
                }
            }
        }

        function updateTotal() {
            let r = document.getElementById('o_prod').value, g = document.getElementById('o_gram').value;
            if(r && g>=100) document.getElementById('o_price').innerText = `‚Çπ${((r/1000)*g).toFixed(2)}`;
        }

        function submitOrder() {
            let pr = document.getElementById('o_price').innerText.replace('‚Çπ','');
            let meth = document.getElementById('o_method').value, addr = document.getElementById('o_addr').value;
            if(pr == "0.00" || !addr) return alert("Fill all!");
            let id = "ORD" + Math.floor(Math.random()*9999);
            db.orders.push({id:id, name:currentUser.name, phone:currentUser.phone, price:pr, method:meth, status:"Pending"});
            save();
            if(meth === "Online") {
                let upi = `upi://pay?pa=7033578145@sbi&pn=Mithila&am=${pr}&cu=INR&tn=${id}`;
                document.getElementById('qrcode').innerHTML = ""; new QRCode(document.getElementById('qrcode'),{text:upi,width:120,height:120});
            }
            alert("Order Success!"); loadUser();
            window.open(`https://wa.me/916200732472?text=NewOrder_${id}_${meth}`);
        }

        function cancelOrder(id) {
            if(!confirm("Order Cancel Karein?")) return;
            db.orders = db.orders.filter(o => o.id !== id);
            save(); alert("Cancelled!"); loadUser();
            window.open(`https://wa.me/916200732472?text=Order_Cancelled_${id}`);
        }

        // --- ADMIN ---
        function loadAdmin() {
            let ot = document.querySelector('#admin_orders tbody'); ot.innerHTML = "";
            let earn = 0;
            db.orders.forEach((o, i) => {
                if(o.status === "Delivered") earn += parseFloat(o.price);
                ot.innerHTML += `<tr><td>${o.id}</td><td>${o.name}</td><td>${o.method}</td>
                <td><select onchange="db.orders[${i}].status=this.value; save(); loadAdmin();"><option ${o.status=='Pending'?'selected':''}>Pending</option><option ${o.status=='Delivered'?'selected':''}>Delivered</option><option ${o.status=='Cancelled'?'selected':''}>Cancelled</option></select></td>
                <td><button onclick="deleteOrder(${i})" style="color:red; border:none; background:none; cursor:pointer;">Delete</button></td></tr>`;
            });
            document.getElementById('earning').innerText = `Earning: ‚Çπ${earn.toFixed(2)}`;
        }

        function deleteOrder(i) {
            if(confirm("Order Delete?")) { db.orders.splice(i,1); save(); loadAdmin(); }
        }

        window.onload = genCap;
    </script>
</body>
</html>
