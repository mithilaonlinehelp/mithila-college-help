<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mithila Help - Final Fixed Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --orange: #FF9933; --green: #138808; --blue: #007BFF; --red: #dc3545; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f4f7f6; padding: 10px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); max-width: 480px; margin: 20px auto; }
        .admin-card { max-width: 1000px; background: #fff; padding: 20px; border-radius: 10px; margin: auto; }
        h2 { text-align: center; color: var(--green); margin-bottom: 20px; border-bottom: 2px solid var(--orange); padding-bottom: 5px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; outline: none; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 30px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-blue { background: var(--blue); }
        .btn-red { background: var(--red); }
        .btn-green { background: var(--green); }
        .captcha { background: #eee; text-align: center; font-size: 22px; font-weight: bold; padding: 10px; border-radius: 8px; margin: 10px 0; letter-spacing: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .link-text { text-align: center; margin-top: 15px; font-size: 14px; }
        .link-text span { color: var(--blue); cursor: pointer; font-weight: bold; text-decoration: underline; }
        #register-page, #forget-page, #order-page, #admin-page, #profile-page { display: none; }
    </style>
</head>
<body>

    <div id="login-page" class="card" style="display:block;">
        <h2>üîê ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <input type="text" id="l_user" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§Ø‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§®‡§æ‡§Æ">
        <input type="password" id="l_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <div class="captcha" id="cap_box"></div>
        <input type="number" id="l_cap" placeholder="‡§â‡§§‡•ç‡§§‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç">
        <button class="btn btn-blue" onclick="handleLogin()">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
        <div class="link-text">‡§®‡§Ø‡•á ‡§Ø‡•Ç‡§ú‡§∞? <span onclick="showPage('register-page')">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</span></div>
        <div class="link-text"><span onclick="showPage('forget-page')">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§≠‡•Ç‡§≤ ‡§ó‡§è?</span></div>
    </div>

    <div id="register-page" class="card">
        <h2>üìù ‡§®‡§Ø‡§æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h2>
        <input type="text" id="r_name" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
        <input type="text" id="r_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <label style="font-size:12px; font-weight:bold;">‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø (DOB) ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è:</label>
        <input type="date" id="r_dob">
        <input type="password" id="r_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç">
        <button class="btn btn-blue" onclick="handleRegister()">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
        <div class="link-text"><span onclick="showPage('login-page')">‡§µ‡§æ‡§™‡§∏ ‡§≤‡•â‡§ó‡§ø‡§®</span></div>
    </div>

    <div id="forget-page" class="card">
        <h2>üîç ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä</h2>
        <input type="text" id="f_phone" placeholder="‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞‡•ç‡§° ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <label style="font-size:12px; font-weight:bold;">‡§Ö‡§™‡§®‡•Ä DOB ‡§ö‡•Å‡§®‡•á‡§Ç:</label>
        <input type="date" id="f_dob">
        <button class="btn btn-blue" onclick="handleForget()">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å</button>
        <div class="link-text"><span onclick="showPage('login-page')">‡§µ‡§æ‡§™‡§∏ ‡§≤‡•â‡§ó‡§ø‡§®</span></div>
    </div>

    <div id="order-page" class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 id="u_welcome">‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</h3>
            <span onclick="loadProfile()" style="color:var(--blue); cursor:pointer; font-size:14px; font-weight:bold;">‚öôÔ∏è ‡§è‡§°‡§ø‡§ü ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤</span>
        </div>
        <div id="u_status" style="background:#fff3cd; padding:10px; border-radius:8px; margin:10px 0; display:none; font-size:13px;"></div>
        
        <select id="o_prod" onchange="updateTotal()"></select>
        <input type="number" id="o_gram" placeholder="‡§µ‡§ú‡§® ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§Æ‡•á‡§Ç (Min 100)" oninput="updateTotal()">
        <p id="o_price" style="text-align:center; font-weight:bold; font-size:20px; color:var(--green); margin:10px 0;">‚Çπ0.00</p>
        <input type="text" id="o_addr" placeholder="‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ">
        
        <label style="font-size:13px; font-weight:bold;">‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™:</label>
        <select id="o_method">
            <option value="Online">Online UPI Payment</option>
            <option value="COD">Cash on Delivery (COD)</option>
        </select>

        <button class="btn btn-green" onclick="submitOrder()">‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç</button>
        <div id="qrcode" style="display:flex; justify-content:center; margin-top:15px;"></div>
        <div id="user_cancel_area"></div>
        <button class="btn btn-red" onclick="location.reload()">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
    </div>

    <div id="admin-page" class="admin-card">
        <h2>üõ†Ô∏è ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§™‡•à‡§®‡§≤: Shreya Rani</h2>
        <div style="background:#d1ecf1; padding:15px; border-radius:10px; text-align:center; font-weight:bold; margin-bottom:20px;">‡§ï‡•Å‡§≤ ‡§ï‡§Æ‡§æ‡§à (Delivered): <span id="earning">‚Çπ0.00</span></div>
        
        <div style="background:#eef; padding:15px; border-radius:10px; margin-bottom:20px;">
            <h3>üì¶ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§î‡§∞ ‡§∞‡•á‡§ü ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</h3>
            <input type="text" id="p_name" placeholder="‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§®‡§æ‡§Æ">
            <input type="number" id="p_rate" placeholder="‡§∞‡•á‡§ü ‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã">
            <button class="btn btn-blue" onclick="addUpdateProduct()">Product Save/Update</button>
            <table id="prod_table"><thead><tr><th>‡§®‡§æ‡§Æ</th><th>‡§∞‡•á‡§ü</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead><tbody id="p_list_admin"></tbody></table>
        </div>

        <h3>üë• ‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü</h3>
        <table id="admin_orders">
            <thead><tr><th>ID</th><th>‡§®‡§æ‡§Æ/‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤</th><th>‡§™‡•á‡§Æ‡•á‡§Ç‡§ü</th><th>‡§∏‡•ç‡§ü‡•á‡§ü‡§∏</th><th>‡§∏‡§Æ‡§Ø</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead>
            <tbody></tbody>
        </table>
        <button class="btn btn-red" onclick="location.reload()" style="max-width:200px; margin:20px auto; display:block;">Logout Admin</button>
    </div>

    <script>
        let correctCap = 0, currentUser = null;
        let db = JSON.parse(localStorage.getItem('mch_final_db')) || {
            users: [], products: [{name:"Packet A", rate:9300},{name:"Packet B", rate:11700}], orders: [], blocked: []
        };

        function save() { localStorage.setItem('mch_final_db', JSON.stringify(db)); }

        function showPage(id) {
            document.querySelectorAll('div[id$="-page"], div[id$="-box"]').forEach(p => p.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if(id === 'login-page') genCap();
        }

        function genCap() {
            let a = Math.floor(Math.random()*10), b = Math.floor(Math.random()*10);
            correctCap = a+b; document.getElementById('cap_box').innerText = `${a} + ${b} = ?`;
        }

        function handleRegister() {
            let n = document.getElementById('r_name').value, ph = document.getElementById('r_phone').value,
                d = document.getElementById('r_dob').value, ps = document.getElementById('r_pass').value;
            if(!n || ph.length < 10 || !d || !ps) return alert("‡§∏‡§¨ ‡§≠‡§∞‡•á‡§Ç!");
            db.users.push({name:n, phone:ph, dob:d, pass:ps}); save(); alert("‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§∏‡§´‡§≤!"); showPage('login-page');
        }

        function handleForget() {
            let ph = document.getElementById('f_phone').value, d = document.getElementById('f_dob').value;
            let u = db.users.find(x => x.phone === ph && x.dob === d);
            if(u) alert(`‡§Ü‡§™‡§ï‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§π‡•à: ${u.pass}`); else alert("‡§°‡•á‡§ü‡§æ ‡§Æ‡•à‡§ö ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü!");
        }

        function handleLogin() {
            let u = document.getElementById('l_user').value, p = document.getElementById('l_pass').value, c = document.getElementById('l_cap').value;
            if(c != correctCap) return alert("Wrong Captcha!");
            if(u === "shreya rani" && p === "mydearshreya@#") { loadAdmin(); showPage('admin-page'); return; }
            let user = db.users.find(x => x.phone === u && x.pass === p);
            if(user) { if(db.blocked.includes(u)) return alert("Blocked!"); currentUser = user; loadUser(); showPage('order-page'); } else alert("Error!");
        }

        function loadUser() {
            document.getElementById('u_welcome').innerText = "‡§®‡§Æ‡§∏‡•ç‡§§‡•á, " + currentUser.name;
            let sel = document.getElementById('o_prod'); sel.innerHTML = `<option value="">‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç</option>`;
            db.products.forEach(p => sel.innerHTML += `<option value="${p.rate}">${p.name}</option>`);
            
            let last = db.orders.slice().reverse().find(o => o.phone === currentUser.phone);
            let cancelArea = document.getElementById('user_cancel_area'); cancelArea.innerHTML = "";
            if(last) {
                document.getElementById('u_status').style.display='block';
                document.getElementById('u_status').innerHTML = `üìå <b>‡§∏‡•ç‡§ü‡•á‡§ü‡§∏:</b> ${last.status} | ‚è≥ <b>‡§∏‡§Æ‡§Ø:</b> ${last.eta || '‡§ú‡§≤‡•ç‡§¶'}`;
                if(last.status === "Pending") cancelArea.innerHTML = `<button class="btn btn-red" onclick="cancelOrder('${last.id}')">Cancel Order</button>`;
            }
        }

        function updateTotal() {
            let r = document.getElementById('o_prod').value, g = document.getElementById('o_gram').value;
            if(r && g>=100) document.getElementById('o_price').innerText = `‚Çπ${((r/1000)*g).toFixed(2)}`;
        }

        function submitOrder() {
            let pr = document.getElementById('o_price').innerText.replace('‚Çπ','');
            let meth = document.getElementById('o_method').value, addr = document.getElementById('o_addr').value;
            if(pr === "0.00" || !addr) return alert("‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç!");
            let id = "MCH" + Math.floor(Math.random()*9999);
            db.orders.push({id:id, name:currentUser.name, phone:currentUser.phone, price:pr, method:meth, status:"Pending", eta:""});
            save();
            if(meth === "Online") {
                let upi = `upi://pay?pa=7033578145@sbi&pn=Mithila&am=${pr}&cu=INR&tn=${id}`;
                document.getElementById('qrcode').innerHTML = ""; new QRCode(document.getElementById('qrcode'), {text:upi, width:150, height:150});
            } else { document.getElementById('qrcode').innerHTML = "<h3>‚úÖ COD Order Recorded</h3>"; }
            loadUser();
            window.open(`https://wa.me/916200732472?text=New_Order_${id}_${meth}`);
        }

        // ADMIN FUNCTIONS
        function loadAdmin() {
            let pl = document.getElementById('p_list_admin'); pl.innerHTML = "";
            db.products.forEach((p, i) => {
                pl.innerHTML += `<tr><td>${p.name}</td><td>${p.rate}</td><td><button onclick="editP(${i})">Edit</button> | <button onclick="delP(${i})">X</button></td></tr>`;
            });
            let ot = document.querySelector('#admin_orders tbody'); ot.innerHTML = "";
            let earn = 0;
            db.orders.forEach((o, i) => {
                if(o.status === "Delivered") earn += parseFloat(o.price);
                ot.innerHTML += `<tr><td>${o.id}</td><td>${o.name}</td><td>${o.method}</td>
                <td><select onchange="db.orders[${i}].status=this.value; save(); loadAdmin();"><option ${o.status=='Pending'?'selected':''}>Pending</option><option ${o.status=='Delivered'?'selected':''}>Delivered</option></select></td>
                <td><input value="${o.eta}" onchange="db.orders[${i}].eta=this.value; save();" style="width:70px"></td>
                <td><button onclick="db.orders.splice(${i},1); save(); loadAdmin();">Delete</button></td></tr>`;
            });
            document.getElementById('earning').innerText = `‚Çπ${earn.toFixed(2)}`;
        }

        function addUpdateProduct() {
            let n = document.getElementById('p_name').value, r = document.getElementById('p_rate').value;
            let idx = db.products.findIndex(x => x.name === n);
            if(idx > -1) db.products[idx].rate = r; else db.products.push({name:n, rate:r});
            save(); loadAdmin(); alert("Saved!");
        }

        function editP(i) { document.getElementById('p_name').value = db.products[i].name; document.getElementById('p_rate').value = db.products[i].rate; }
        function delP(i) { db.products.splice(i,1); save(); loadAdmin(); }

        window.onload = genCap;
    </script>
</body>
</html>
