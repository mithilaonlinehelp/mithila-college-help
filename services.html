<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mithila Help - Super Controller System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --orange: #FF9933; --green: #138808; --blue: #007BFF; --red: #dc3545; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: #f8f9fa; padding: 15px; }
        .box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 450px; margin: 15px auto; display: none; }
        .admin-wide { max-width: 1100px; background: white; padding: 20px; border-radius: 12px; margin: auto; display: none; overflow-x: auto; border-top: 5px solid var(--green); }
        h2 { text-align: center; color: var(--green); margin-bottom: 15px; border-bottom: 2px solid var(--orange); }
        input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 6px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 25px; color: white; font-weight: bold; cursor: pointer; margin-top: 8px; }
        .btn-blue { background: var(--blue); }
        .btn-green { background: var(--green); }
        .btn-red { background: var(--red); }
        .captcha { background: #eee; text-align: center; font-size: 20px; font-weight: bold; padding: 8px; border-radius: 6px; letter-spacing: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f1f1f1; }
        .status-tag { padding: 3px 6px; border-radius: 4px; color: white; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="box-login" class="box" style="display:block;">
        <h2>üîê ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <input type="text" id="l_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§Ø‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§®‡§æ‡§Æ">
        <input type="password" id="l_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <div id="cap_text" class="captcha"></div>
        <input type="number" id="l_cap_in" placeholder="‡§â‡§§‡•ç‡§§‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç">
        <button class="btn btn-blue" onclick="doLogin()">‡§≤‡•â‡§ó‡§ø‡§®</button>
        <p style="text-align:center; font-size:12px; margin-top:10px;">
            <span onclick="go('box-reg')" style="color:var(--blue); cursor:pointer;">‡§®‡§Ø‡§æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</span> | 
            <span onclick="go('box-forget')" style="color:var(--blue); cursor:pointer;">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§≠‡•Ç‡§≤ ‡§ó‡§è?</span>
        </p>
    </div>

    <div id="box-reg" class="box">
        <h2>üìù ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h2>
        <input type="text" id="r_name" placeholder="‡§®‡§æ‡§Æ">
        <input type="text" id="r_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤">
        <input type="date" id="r_dob" title="DOB">
        <input type="password" id="r_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <button class="btn btn-blue" onclick="doReg()">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞</button>
        <button class="btn" style="background:#666;" onclick="go('box-login')">‡§µ‡§æ‡§™‡§∏</button>
    </div>

    <div id="box-forget" class="box">
        <h2>üîç ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä</h2>
        <input type="text" id="f_phone" placeholder="‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞‡•ç‡§° ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤">
        <input type="date" id="f_dob">
        <button class="btn btn-blue" onclick="doForget()">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
        <button class="btn" style="background:#666;" onclick="go('box-login')">‡§µ‡§æ‡§™‡§∏</button>
    </div>

    <div id="box-order" class="box">
        <h3 id="wel_user">‡§®‡§Æ‡§∏‡•ç‡§§‡•á</h3>
        <div id="track_box" style="background:#fff3cd; padding:8px; border-radius:6px; margin:10px 0; font-size:12px; border:1px solid #ffeeba; display:none;"></div>
        
        <select id="sel_p" onchange="calc()"></select>
        <input type="number" id="sel_g" placeholder="‡§ó‡•ç‡§∞‡§æ‡§Æ" oninput="calc()">
        <p id="total_p" style="text-align:center; font-weight:bold; font-size:20px; color:var(--green); margin:10px 0;">‚Çπ0.00</p>
        <input type="text" id="sel_ad" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ">
        
        <select id="sel_m">
            <option value="Online">Online Payment</option>
            <option value="COD">Cash on Delivery (COD)</option>
        </select>

        <button class="btn btn-green" onclick="placeOrder()">‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç</button>
        <div id="qr_box" style="display:flex; justify-content:center; margin-top:10px;"></div>
        <button class="btn btn-red" onclick="location.reload()">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
    </div>

    <div id="box-admin" class="admin-wide">
        <h2>üõ†Ô∏è ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤‡§∞: Shreya Rani</h2>
        
        <div style="background:#eef; padding:15px; border-radius:10px; margin-bottom:20px;">
            <h3>üì¶ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</h3>
            <input type="text" id="adm_pn" placeholder="‡§®‡§æ‡§Æ" style="width:40%">
            <input type="number" id="adm_pr" placeholder="‡§∞‡•á‡§ü" style="width:30%">
            <button onclick="admAddP()" style="padding:10px; border-radius:6px; background:var(--blue); color:white; border:none;">Save</button>
            <table id="tbl_p"><thead><tr><th>‡§®‡§æ‡§Æ</th><th>‡§∞‡•á‡§ü</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead><tbody></tbody></table>
        </div>

        <h3>üë• ‡§Ø‡•Ç‡§ú‡§∞ ‡§î‡§∞ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤</h3>
        <table id="tbl_o">
            <thead>
                <tr><th>ID</th><th>‡§®‡§æ‡§Æ/‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤</th><th>‡§™‡•á‡§Æ‡•á‡§Ç‡§ü</th><th>‡§∏‡•ç‡§ü‡•á‡§ü‡§∏</th><th>Delay/‡§∏‡§Æ‡§Ø</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr>
            </thead>
            <tbody></tbody>
        </table>
        <button class="btn btn-red" onclick="location.reload()" style="max-width:200px; display:block; margin:20px auto;">‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
    </div>

    <script>
        let capAns = 0, user = null;
        let db = JSON.parse(localStorage.getItem('mch_v20')) || {
            users: [], products: [{name:"Packet A", rate:9300}], orders: [], blocked: []
        };

        function save() { localStorage.setItem('mch_v20', JSON.stringify(db)); }

        function go(id) {
            document.querySelectorAll('.box, .admin-wide').forEach(b => b.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if(id === 'box-login') genCap();
        }

        function genCap() {
            let a = Math.floor(Math.random()*10), b = Math.floor(Math.random()*10);
            capAns = a + b; document.getElementById('cap_text').innerText = `${a} + ${b} = ?`;
        }

        function doReg() {
            let n = document.getElementById('r_name').value, ph = document.getElementById('r_phone').value,
                d = document.getElementById('r_dob').value, ps = document.getElementById('r_pass').value;
            db.users.push({name:n, phone:ph, dob:d, pass:ps}); save(); alert("‡§∏‡§´‡§≤!"); go('box-login');
        }

        function doForget() {
            let ph = document.getElementById('f_phone').value, d = document.getElementById('f_dob').value;
            let find = db.users.find(x => x.phone === ph && x.dob === d);
            if(find) alert("‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°: " + find.pass); else alert("‡§°‡•á‡§ü‡§æ ‡§ó‡§≤‡§§ ‡§π‡•à!");
        }

        function doLogin() {
            let u = document.getElementById('l_phone').value, p = document.getElementById('l_pass').value, c = document.getElementById('l_cap_in').value;
            if(c != capAns) return alert("Wrong Captcha");
            if(u === "shreya rani" && p === "mydearshreya@#") { loadAdmin(); go('box-admin'); return; }
            if(db.blocked.includes(u)) return alert("‚ùå ‡§Ü‡§™ ‡§¨‡•ç‡§≤‡•â‡§ï ‡§π‡•à‡§Ç! ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§");
            let find = db.users.find(x => x.phone === u && x.pass === p);
            if(find) { user = find; loadUser(); go('box-order'); } else alert("‡§≤‡•â‡§ó‡§ø‡§® ‡§Ö‡§∏‡§´‡§≤!");
        }

        function loadUser() {
            document.getElementById('wel_user').innerText = "‡§®‡§Æ‡§∏‡•ç‡§§‡•á, " + user.name;
            let s = document.getElementById('sel_p'); s.innerHTML = "<option value=''>‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç</option>";
            db.products.forEach(p => s.innerHTML += `<option value="${p.rate}">${p.name}</option>`);
            let last = db.orders.slice().reverse().find(o => o.phone === user.phone);
            if(last) {
                document.getElementById('track_box').style.display = 'block';
                document.getElementById('track_box').innerHTML = `üìå ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏: <b>${last.status}</b> | ‚è≥ ‡§∏‡§Æ‡§Ø: <b>${last.eta || 'Calculating'}</b>`;
            }
        }

        function calc() {
            let r = document.getElementById('sel_p').value, g = document.getElementById('sel_g').value;
            if(r && g>=100) document.getElementById('total_p').innerText = `‚Çπ${((r/1000)*g).toFixed(2)}`;
        }

        function placeOrder() {
            let pr = document.getElementById('total_p').innerText.replace('‚Çπ','');
            let m = document.getElementById('sel_m').value, ad = document.getElementById('sel_ad').value;
            if(pr === "0.00" || !ad) return alert("‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!");
            let id = "MCH" + Math.floor(Math.random()*9999);
            db.orders.push({id:id, name:user.name, phone:user.phone, price:pr, method:m, status:"Pending", eta:""});
            save();
            if(m === "Online") {
                let upi = `upi://pay?pa=7033578145@sbi&pn=Mithila&am=${pr}&cu=INR&tn=${id}`;
                document.getElementById('qr_box').innerHTML = ""; new QRCode(document.getElementById('qr_box'),{text:upi,width:120,height:120});
            } else { document.getElementById('qr_box').innerHTML = "<h3 style='color:green'>‚úÖ COD Success</h3>"; }
            loadUser(); window.open(`https://wa.me/916200732472?text=New_Order_${id}_Amt_${pr}`);
        }

        // --- ADMIN FUNCTIONS ---
        function loadAdmin() {
            // Products
            let pl = document.getElementById('tbl_p').querySelector('tbody'); pl.innerHTML = "";
            db.products.forEach((p, i) => { pl.innerHTML += `<tr><td>${p.name}</td><td>${p.rate}</td><td><button onclick="admEdP(${i})">Edit</button></td></tr>`; });
            
            // Users & Orders
            let ol = document.getElementById('tbl_o').querySelector('tbody'); ol.innerHTML = "";
            db.orders.forEach((o, i) => {
                let isBlocked = db.blocked.includes(o.phone);
                ol.innerHTML += `<tr>
                    <td>${o.id}</td>
                    <td>${o.name}<br>${o.phone}</td>
                    <td>${o.method}</td>
                    <td>
                        <select onchange="db.orders[${i}].status=this.value; save();">
                            <option ${o.status=='Pending'?'selected':''}>Pending</option>
                            <option ${o.status=='Delivered'?'selected':''}>Delivered</option>
                            <option ${o.status=='Cancelled'?'selected':''}>Cancelled</option>
                        </select>
                    </td>
                    <td><input value="${o.eta}" onchange="db.orders[${i}].eta=this.value; save();" placeholder="e.g. 2 Hours"></td>
                    <td>
                        <button onclick="toggleB('${o.phone}')" style="background:${isBlocked?'green':'red'}; color:white; border:none; padding:4px;">${isBlocked?'Unblock':'Block'}</button>
                        <button onclick="db.orders.splice(${i},1); save(); loadAdmin();" style="margin-left:5px;">Del</button>
                    </td>
                </tr>`;
            });
        }

        function admAddP() {
            let n = document.getElementById('adm_pn').value, r = document.getElementById('adm_pr').value;
            let idx = db.products.findIndex(x => x.name === n);
            if(idx > -1) db.products[idx].rate = r; else db.products.push({name:n, rate:r});
            save(); loadAdmin();
        }
        function admEdP(i) { document.getElementById('adm_pn').value=db.products[i].name; document.getElementById('adm_pr').value=db.products[i].rate; }
        function toggleB(ph) {
            if(db.blocked.includes(ph)) db.blocked = db.blocked.filter(x => x !== ph);
            else db.blocked.push(ph);
            save(); loadAdmin();
        }

        window.onload = genCap;
    </script>
</body>
</html>
