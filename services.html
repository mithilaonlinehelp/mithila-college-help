<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mithila Help - New Fixed System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --orange: #FF9933; --green: #138808; --blue: #007BFF; --red: #dc3545; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0f2f5; padding: 10px; min-height: 100vh; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); max-width: 480px; margin: 20px auto; }
        .admin-card { max-width: 1000px; background: #fff; padding: 20px; border-radius: 10px; margin: auto; }
        h2 { text-align: center; color: var(--green); margin-bottom: 20px; border-bottom: 2px solid var(--orange); padding-bottom: 5px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; outline: none; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 30px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-blue { background: var(--blue); }
        .btn-red { background: var(--red); }
        .btn-green { background: var(--green); }
        .captcha { background: #eee; text-align: center; font-size: 24px; font-weight: bold; padding: 12px; border-radius: 8px; margin: 10px 0; letter-spacing: 5px; }
        .link-area { text-align: center; margin-top: 15px; font-size: 14px; color: var(--blue); }
        .link-area span { cursor: pointer; font-weight: bold; text-decoration: underline; margin: 0 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .history-item { border-bottom: 1px solid #eee; padding: 10px 0; font-size: 13px; }
        #register-box, #forget-box, #order-box, #admin-box, #profile-box { display: none; }
    </style>
</head>
<body>

    <div id="login-box" class="card" style="display:block;">
        <h2>üîê ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <input type="text" id="l_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ / ‡§è‡§°‡§Æ‡§ø‡§®">
        <input type="password" id="l_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <div class="captcha" id="cap_display"></div>
        <input type="number" id="l_cap_in" placeholder="‡§ä‡§™‡§∞ ‡§ï‡§æ ‡§ú‡•ã‡•ú ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç">
        <button class="btn btn-blue" onclick="processLogin()">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
        <div class="link-area">
            <span onclick="showSection('register-box')">Register</span> | 
            <span onclick="showSection('forget-box')">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§≠‡•Ç‡§≤ ‡§ó‡§è?</span>
        </div>
    </div>

    <div id="register-box" class="card">
        <h2>üìù ‡§®‡§Ø‡§æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h2>
        <input type="text" id="r_name" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
        <input type="text" id="r_phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <label style="font-size:12px; font-weight:bold;">‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø (‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è):</label>
        <input type="date" id="r_dob">
        <input type="password" id="r_pass" placeholder="‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <button class="btn btn-blue" onclick="processRegister()">Register Now</button>
        <div class="link-area"><span onclick="showSection('login-box')">‡§µ‡§æ‡§™‡§∏ ‡§≤‡•â‡§ó‡§ø‡§®</span></div>
    </div>

    <div id="forget-box" class="card">
        <h2>üîç ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¢‡•Ç‡§Ç‡§¢‡•á‡§Ç</h2>
        <input type="text" id="f_phone" placeholder="‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞‡•ç‡§° ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <label style="font-size:12px; font-weight:bold;">‡§Ö‡§™‡§®‡•Ä DOB ‡§ö‡•Å‡§®‡•á‡§Ç:</label>
        <input type="date" id="f_dob">
        <button class="btn btn-blue" onclick="processForget()">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å</button>
        <div class="link-area"><span onclick="showSection('login-box')">‡§µ‡§æ‡§™‡§∏ ‡§≤‡•â‡§ó‡§ø‡§®</span></div>
    </div>

    <div id="profile-box" class="card">
        <h2>üë§ ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§è‡§°‡§ø‡§ü</h2>
        <input type="text" id="e_name" placeholder="‡§®‡§Ø‡§æ ‡§®‡§æ‡§Æ">
        <input type="password" id="e_pass" placeholder="‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <button class="btn btn-green" onclick="updateProfile()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
        <div class="link-area"><span onclick="showSection('order-box')">‡§µ‡§æ‡§™‡§∏ ‡§Ü‡§∞‡•ç‡§°‡§∞ ‡§™‡•á‡§ú</span></div>
    </div>

    <div id="order-box" class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 id="welcome_user">‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</h3>
            <span onclick="openEdit()" style="color:var(--blue); font-weight:bold; cursor:pointer; font-size:12px;">‚öôÔ∏è Edit</span>
        </div>
        <div id="live_status" style="background:#fff3cd; padding:10px; border-radius:8px; margin:10px 0; display:none; font-size:13px; border:1px solid #ffeeba;"></div>
        
        <select id="sel_prod" onchange="calcTotal()"></select>
        <input type="number" id="sel_gram" placeholder="‡§ó‡•ç‡§∞‡§æ‡§Æ (Min 100)" oninput="calcTotal()">
        <p id="final_price" style="text-align:center; font-weight:bold; font-size:22px; color:var(--green); margin:10px 0;">‚Çπ0.00</p>
        <input type="text" id="sel_addr" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§™‡§§‡§æ">
        
        <label style="font-size:12px; font-weight:bold;">‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§Æ‡•ã‡§°:</label>
        <select id="sel_method">
            <option value="Online">Online UPI Payment</option>
            <option value="COD">Cash on Delivery (COD)</option>
        </select>

        <button class="btn btn-green" onclick="placeFinalOrder()">üí∞ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç</button>
        <div id="qr_area" style="display:flex; justify-content:center; margin-top:15px;"></div>
        
        <hr style="margin:20px 0;">
        <h4>üìú ‡§Ü‡§™‡§ï‡•á ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏</h4>
        <div id="user_history" style="max-height:150px; overflow-y:auto;"></div>
        
        <button class="btn btn-red" onclick="location.reload()">Logout</button>
    </div>

    <div id="admin-box" class="admin-card">
        <h2>üõ†Ô∏è ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§™‡•à‡§®‡§≤: Shreya Rani</h2>
        <div style="background:#d1ecf1; padding:15px; border-radius:10px; text-align:center; font-weight:bold; margin-bottom:20px; font-size:18px;">Total Delivered Sales: <span id="adm_earn">‚Çπ0.00</span></div>
        
        <div style="background:#eef; padding:15px; border-radius:10px; margin-bottom:20px;">
            <h3>üì¶ ‡§Æ‡•à‡§®‡•á‡§ú ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü‡•ç‡§∏</h3>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <input type="text" id="adm_p_name" placeholder="‡§®‡§æ‡§Æ" style="flex:1;">
                <input type="number" id="adm_p_rate" placeholder="‡§∞‡•á‡§ü/kg" style="flex:1;">
                <button class="btn btn-blue" onclick="admAddProd()" style="margin:0; width:100px;">Save</button>
            </div>
            <table style="margin-top:10px;"><thead><tr><th>Item</th><th>Rate</th><th>Action</th></tr></thead><tbody id="adm_p_list"></tbody></table>
        </div>

        <h3>üìã ‡§Ü‡§∞‡•ç‡§°‡§∞‡•ç‡§∏ ‡§î‡§∞ ‡§Ø‡•Ç‡§ú‡§∞‡•ç‡§∏</h3>
        <div style="overflow-x:auto;">
            <table>
                <thead><tr><th>ID</th><th>Customer</th><th>Mode</th><th>Status</th><th>ETA</th><th>Action</th></tr></thead>
                <tbody id="adm_o_list"></tbody>
            </table>
        </div>
        <button class="btn btn-red" onclick="location.reload()" style="max-width:200px; margin:20px auto; display:block;">Admin Logout</button>
    </div>

    <script>
        let capAns = 0, loggedUser = null;
        let db = JSON.parse(localStorage.getItem('mch_v5_data')) || {
            users: [], products: [{name:"Packet A", rate:9300},{name:"Packet B", rate:11700}], orders: [], blocked: []
        };

        function save() { localStorage.setItem('mch_v5_data', JSON.stringify(db)); }

        function showSection(id) {
            document.querySelectorAll('div[id$="-box"]').forEach(b => b.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if(id === 'login-box') createCap();
        }

        function createCap() {
            let a = Math.floor(Math.random()*10), b = Math.floor(Math.random()*10);
            capAns = a + b;
            document.getElementById('cap_display').innerText = `${a} + ${b} = ?`;
        }

        function processRegister() {
            let n = document.getElementById('r_name').value, ph = document.getElementById('r_phone').value,
                d = document.getElementById('r_dob').value, ps = document.getElementById('r_pass').value;
            if(!n || ph.length < 10 || !d || !ps) return alert("Pura bharen!");
            db.users.push({name:n, phone:ph, dob:d, pass:ps}); save(); alert("Success!"); showSection('login-box');
        }

        function processForget() {
            let ph = document.getElementById('f_phone').value, d = document.getElementById('f_dob').value;
            let u = db.users.find(x => x.phone === ph && x.dob === d);
            if(u) alert("Aapka Password hai: " + u.pass); else alert("Data nahi mila!");
        }

        function processLogin() {
            let u = document.getElementById('l_phone').value, p = document.getElementById('l_pass').value, c = document.getElementById('l_cap_in').value;
            if(c != capAns) return alert("Wrong Captcha!");
            if(u === "shreya rani" && p === "mydearshreya@#") { loadAdmin(); showSection('admin-box'); return; }
            let user = db.users.find(x => x.phone === u && x.pass === p);
            if(user) { if(db.blocked.includes(u)) return alert("Blocked!"); loggedUser = user; loadUserPage(); showSection('order-box'); } else alert("Login Failed!");
        }

        function openEdit() {
            document.getElementById('e_name').value = loggedUser.name;
            document.getElementById('e_pass').value = loggedUser.pass;
            showSection('profile-box');
        }

        function updateProfile() {
            let idx = db.users.findIndex(x => x.phone === loggedUser.phone);
            db.users[idx].name = document.getElementById('e_name').value;
            db.users[idx].pass = document.getElementById('e_pass').value;
            loggedUser = db.users[idx]; save(); alert("Updated!"); loadUserPage(); showSection('order-box');
        }

        function loadUserPage() {
            document.getElementById('welcome_user').innerText = "‡§®‡§Æ‡§∏‡•ç‡§§‡•á, " + loggedUser.name;
            let sel = document.getElementById('sel_prod'); sel.innerHTML = `<option value="">‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç</option>`;
            db.products.forEach(p => sel.innerHTML += `<option value="${p.rate}">${p.name}</option>`);
            
            let history = document.getElementById('user_history'); history.innerHTML = "";
            db.orders.slice().reverse().forEach(o => {
                if(o.phone === loggedUser.phone) {
                    history.innerHTML += `<div class="history-item"><b>${o.id}:</b> ‚Çπ${o.price} (${o.status}) - ${o.eta || '‡§ú‡§≤‡•ç‡§¶'}</div>`;
                }
            });
            let last = db.orders.slice().reverse().find(o => o.phone === loggedUser.phone);
            if(last) { document.getElementById('live_status').style.display='block'; document.getElementById('live_status').innerHTML = `üìå <b>Status:</b> ${last.status} | ‚è≥ <b>Time:</b> ${last.eta || '‡§ú‡§≤‡•ç‡§¶'}`; }
        }

        function calcTotal() {
            let r = document.getElementById('sel_prod').value, g = document.getElementById('sel_gram').value;
            if(r && g>=100) document.getElementById('final_price').innerText = `‚Çπ${((r/1000)*g).toFixed(2)}`;
        }

        function placeFinalOrder() {
            let pr = document.getElementById('final_price').innerText.replace('‚Çπ','');
            let meth = document.getElementById('sel_method').value, addr = document.getElementById('sel_addr').value;
            if(pr === "0.00" || !addr) return alert("Pura bharen!");
            let id = "MCH" + Math.floor(Math.random()*9999);
            db.orders.push({id:id, name:loggedUser.name, phone:loggedUser.phone, price:pr, method:meth, status:"Pending", eta:""});
            save();
            if(meth === "Online") {
                let upi = `upi://pay?pa=7033578145@sbi&pn=Mithila&am=${pr}&cu=INR&tn=${id}`;
                document.getElementById('qr_area').innerHTML = ""; new QRCode(document.getElementById('qr_area'),{text:upi,width:150,height:150});
            } else { document.getElementById('qr_area').innerHTML = "<h3 style='color:green'>‚úÖ COD Order Confirmed</h3>"; }
            loadUserPage();
            window.open(`https://wa.me/916200732472?text=New_Order_${id}_Amt_${pr}_Method_${meth}`);
        }

        // ADMIN
        function loadAdmin() {
            let pl = document.getElementById('adm_p_list'); pl.innerHTML = "";
            db.products.forEach((p, i) => { pl.innerHTML += `<tr><td>${p.name}</td><td>${p.rate}</td><td><button onclick="admEditP(${i})">Edit</button> | <button onclick="admDelP(${i})">X</button></td></tr>`; });
            let ot = document.querySelector('#adm_o_list'); ot.innerHTML = "";
            let earn = 0;
            db.orders.forEach((o, i) => {
                if(o.status === "Delivered") earn += parseFloat(o.price);
                ot.innerHTML += `<tr><td>${o.id}</td><td>${o.name}</td><td>${o.method}</td>
                <td><select onchange="db.orders[${i}].status=this.value; save(); loadAdmin();"><option ${o.status=='Pending'?'selected':''}>Pending</option><option ${o.status=='Delivered'?'selected':''}>Delivered</option></select></td>
                <td><input value="${o.eta}" onchange="db.orders[${i}].eta=this.value; save();" style="width:60px"></td>
                <td><button onclick="db.orders.splice(${i},1); save(); loadAdmin();">Del</button></td></tr>`;
            });
            document.getElementById('adm_earn').innerText = `‚Çπ${earn.toFixed(2)}`;
        }

        function admAddProd() {
            let n = document.getElementById('adm_p_name').value, r = document.getElementById('adm_p_rate').value;
            let idx = db.products.findIndex(x => x.name === n);
            if(idx > -1) db.products[idx].rate = r; else db.products.push({name:n, rate:r});
            save(); loadAdmin(); document.getElementById('adm_p_name').value=""; document.getElementById('adm_p_rate').value="";
        }
        function admEditP(i) { document.getElementById('adm_p_name').value=db.products[i].name; document.getElementById('adm_p_rate').value=db.products[i].rate; }
        function admDelP(i) { db.products.splice(i,1); save(); loadAdmin(); }

        window.onload = createCap;
    </script>
</body>
</html>
